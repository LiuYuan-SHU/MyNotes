> redis是一个基于内存的、搞笑的键值型非关系型数据，存取效率极高，而且支持多种数据存储结构，使用起来也非常简单。

# 1. 准备工作

1. Redis安装：https://setup.scrape.center/redis
2. Redis-py安装：`pip3 install redis`

# 2. Redis和StrictRedis

`redis-py`库提供了`Redis`和`StrictRedis`两个类，用来实现Redis命令对应的操作

`StrictRedis`类实现了绝大部分官方的Redis命令，参数也一一对应。而`Redis`类是`StrictRedis`类的子类，其主要功能实现向后兼容旧版本库的几个方法。为了实现兼容，`Redis`类对方法进行了改写。

官方推荐使用`StrictRedis`类，也是本笔记使用的方法。

# 3. 链接Redis

[4.6.1_测试连接](https://github.com/LiuYuan-SHU/MyNotes/blob/614802c5e95f9cb1b7a85dad5e5451ab93ba517a/Crawler%20with%20Python3/Python3%20web%20crawler%20development%20practice%EF%BC%88Edition2%EF%BC%89%20-%20Cui%20Qingcai/%E7%AC%AC%E5%9B%9B%E7%AB%A0/4.6/4.6.1_%E6%B5%8B%E8%AF%95%E8%BF%9E%E6%8E%A5.py)

```python
from redis import StrictRedis

redis = StrictRedis(host='localhost', port=6379, db=0, password='lhr20011228')
redis.set('name', 'Bob')
print(redis.get('name'))
```

这里我们传入了Redis的地址、运行端口、使用的数据库和密码信息。在默认不传参的情况下，这4个参数分别为`localhost`，`6379`，`0`和`None`。然后声明了一个`StrictRedis`对象，并调用了对象的`set`方法，设置了一个键值对。最后调用`get`方法获取了设置的键值并打印出来。

![image-20220726112649183](4.6_Redis缓存存储.assets/image-20220726112649183.png)

这说明我们成功连接了redis

******

当然，我们可以使用`ConnectionPool`来连接Redis，示例代码如下：

```python
from redis import StrictRedis, ConnectPool

rool = ConnectionPool(host='localhost', port=6479, db=0, password=<password>)
redis = StrictRedis(connection_pool=pool)
```

## URL构建连接

```
redis://[:password]@host:port/db				# Redis TCP
rediss://[:password]@host:port/db				# Redis TCP+SSL
unix://[:password]@/path/to/socket.sock?db=db	# Redis UNIX socket
```

```python
url = '<上面三个任意类型URL>'
pool = ConnectionPool.from_url(url)
redis = StrictRedis(connection_pool=pool)
```

# 4. 键操作

| 方法                 | 作用                         | 参数说明                                | 实例                               | 实例说明                      | 实例结果        |
| -------------------- | ---------------------------- | --------------------------------------- | ---------------------------------- | ----------------------------- | --------------- |
| `exists(name)`       | 判断一个键是否存在           | `name`：键名                            | `redis.exists('name')`             | 是否存在`name`键              | True            |
| `delete(name)`       | 删除一个键                   | `name`：键名                            | `redis.delete('name')`             | 删除`name`键                  | 1               |
| `type(name)`         | 判断键类型                   | `name`：键名                            | `redis.type('name')`               | 判断`name`键的类型            | b'string'       |
| `keys(pattern)`      | 获取所有符合规则的键         | `pattern`：匹配规则                     | `redis.keys('n*')`                 | 获取所有以`n`开头的键         | [b'name']       |
| `randomkey()`        | 获取随机的一个键             |                                         | `randomykey()`                     | 获取一个随机的键              | True            |
| `rename(src, dst)`   | 对键重命名                   | `src`：原键名</br>`dst`：新键名         | `redis.rename('name', 'nickname')` | 将`name`重命名为`nickname`    | True            |
| `dbsize()`           | 获取当前数据库中键的数目     |                                         | `dbsize()`                         | 获取当前数据库中的键的数目    | 100             |
| `expire(name, time)` | 设定键的过期时间，单位为秒   | `name`：键名</br>`time`：秒数           | `redis.expire('name', 2)`          | 将`name`键的过期时间设置为2秒 | Ture            |
| `ttl(name)`          | 获取键的过期时间，单位为秒   | `name`：键名                            | `redis.ttl('name')`                | 获取`name`键的过去时间        | 1(表示永不过期) |
| `move(name, db)`     | 将键移动到其他数据库         | `name`：键名</br>`db`：以往的数据库代号 | `move('name', 2)`                  | 将`name`键移动到2号数据库     | True            |
| `flushdb()`          | 删除当前所选数据库中的所有键 |                                         | `flushdb`                          | 删除当前所选数据库中的所有键  | True            |
| `flushall()`         | 删除所有数据库中的鄋键       |                                         | `flushall`                         | 删除所有数据库中的所有键      | True            |

# 5. 字符串操作

![image-20220726144319303](4.6_Redis缓存存储.assets/image-20220726144319303.png)

![image-20220726144905306](4.6_Redis缓存存储.assets/image-20220726144905306.png)

# 6. 列表操作

![image-20220726144927272](4.6_Redis缓存存储.assets/image-20220726144927272.png)

![image-20220726145012777](4.6_Redis缓存存储.assets/image-20220726145012777.png)

# 7. 集合操作

集合中的元素都是不重复的

![image-20220726145030188](4.6_Redis缓存存储.assets/image-20220726145030188.png)

![扫描全能王 2022-07-26 14.42_4](4.6_Redis缓存存储.assets/扫描全能王 2022-07-26 14.42_4.jpg)

# 8. 有序集合操作

![扫描全能王 2022-07-26 14.42_5](4.6_Redis缓存存储.assets/扫描全能王 2022-07-26 14.42_5.jpg)

![image-20220726150129796](4.6_Redis缓存存储.assets/image-20220726150129796.png)

# 9. 散列操作

![image-20220726150152778](4.6_Redis缓存存储.assets/image-20220726150152778.png)

![image-20220726150219452](4.6_Redis缓存存储.assets/image-20220726150219452.png)
