[TOC]

> OpenMP程序的一个重要特征是内存空间共享，即多个县城通过任意使用这个共享空间上的变量而完成线程间的数据传递，录音次线程间的数据通信非常方便。具体而言，一个线程A可以通过写操作改变一个变量的值，而另一个线程B通过读操作可以得到此变量的值，从而完成了线程A和线程B之间的通信。
>
> 共享（shared）变量和私有（private）变量是OpenMP中最重要的两个概念。

# 子句`private`、子句`shared`和子句`default`

## 子句`private`

子句private可以将变量列表中的一个或多个变量声明为线程组中子线程的私有变量，然后指定每个线程都有这些变量的私有副本。在并行区域内，每个线程只能访问自己的私有副本，无法访问其他线程的私有副本。

子句private的语法格式如下：

```
private(变量列表)
```

对出现在变量列表中的变量，子句private将其定义成私有变量后，在并行区域的开始为线程组的每个线程产生一个该变量的私有副本。***需要注意的是，子句private声明的私有变量的初始值在并行区域的入口是未定义的，它不会继承并行区域外同名原始变量的值。***

## 子句`shared`

子句shared可将变量列表中一个或多个变量声明为线程组中子线程共享的变量。所谓共享变量，是指在一个并行区域的线程组内所有的线程只拥有该变量的一个内存地址，所有线程对共享变量的访问即是对同一地址的访问。

在并行区域内使用共享变量时，如果存在写操作，必须对共享变量加以保护，否则就容易出现数据竞争。因此不要轻易使用共享变量，尽量将对共享变量的访问转化为私有变量的访问：

```
shared(共享变量)
```

## 子句`default`

一个parallel指令只能被一个default子句修饰。子句default用来控制并行区域内变量的共享属性。如果不加以说明，那么并行区域内所有的变量都是默认公有的。但是有三个例外情况：

1. 循环指标变量默认是私有变量，无需格外声明：

    ```c
    for (int i <-- 指标变量)
    ```

2. 并行区域内的局部变量是私有变量，无需自己另外声明

3. 所有在`private`，`firstprivate`，`lastprivate`和`reduction`子句中列出的变量是私有的

```
default(shared|none)
```

+ 如果使用`default(shared)`，那么传入并行区域内的同名变量均是共享变量，各线程不会产生变量的私有副本
+ 如果使用`default(private)`，那么传入并行区域内的同名变量均是私有变量，由各子线程产生各自的私有变量副本
+ 如果使用`default(none)`，那么除了具有明确定义的变量以外，线程所使用的变量必须显式地进行声明它是私有变量还是共享变量

